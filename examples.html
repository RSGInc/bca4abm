

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples &mdash; bca4abm 0.5
 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Software Implementation" href="software.html" />
    <link rel="prev" title="Getting Started" href="gettingstarted.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> bca4abm
          

          
          </a>

          
            
            
              <div class="version">
                0.5

              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-setup">Basic Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#abm-example">ABM Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#models">Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data">Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#outputs">Outputs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#four-step-example">Four-Step Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Outputs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="software.html">Software Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">bca4abm</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="examples">
<span id="id1"></span><h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<p>There are two example implementations included in the project, one for an activity-based model and one for
for a four-step (trip-based) model.  bca4abm requires model outputs for a base and a build alternative. The required model
outputs which are input to bca4abm need to be the same in each alternative. The values
in the model outputs can be different, but the files, the formats, the number of
matrices, etc. all need to be the same.  The outputs need to be in open data formats - CSV and <a class="reference external" href="https://pypi.org/project/OpenMatrix">open matrix (OMX)</a>.</p>
<div class="section" id="basic-setup">
<h2>Basic Setup<a class="headerlink" href="#basic-setup" title="Permalink to this headline">¶</a></h2>
<p>Each benefits calculator model has the same folder setup:</p>
<blockquote>
<div><ul class="simple">
<li><p>configs - setting and data processor expression files for the overall tool and for each data processor</p></li>
<li><p>data  - base and build model scenario input data tables and matrices</p></li>
<li><p>output - an empty output folder</p></li>
<li><p>run_bca.py - script to run the model</p></li>
</ul>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">configs</span></code> folder contains settings, expressions files, and other files required for specifying
model utilities and form.  The first place to start in the <code class="docutils literal notranslate"><span class="pre">configs</span></code> folder is <code class="docutils literal notranslate"><span class="pre">settings.yaml</span></code>, which
is the main settings file for the model run.  This file includes:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">models</span></code> - list of model steps to run - auto demographics processor, person trips processor, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resume_after</span></code> - to resume running the data pipeline after the last successful checkpoint</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trace_hh_id</span></code> - trace household id; comment out for no trace</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trace_od</span></code> - trace origin, destination pair in accessibility calculation; comment out for no trace</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chunk_size</span></code> - batch size for processing choosers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_tables</span></code> - list of output tables to write to CSV</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dump</span></code> - True or False and specifies if bca4abm should write the output intermediate CSV tables for debugging</p></li>
<li><p>global variables that can be used in expressions tables and Python code such as:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DISCOUNT_RATE</span></code> - cost discounting factor</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ANNUALIZATION_FACTOR</span></code> - daily to annual factor</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Included in the <code class="docutils literal notranslate"><span class="pre">configs</span></code> folder are the model specification files that store the configuration files for each model. Also included
in the <code class="docutils literal notranslate"><span class="pre">configs</span></code> folder is the <code class="docutils literal notranslate"><span class="pre">tables.yaml</span></code> file that stores the file names for each data processor input table,
as well as the mapping from input column names to column names used in the expressions.  The file also specifies the input
table file name and the name of the table used in the expressions.  All fields to be used in expressions must be in the mapping
since the mapping defines which fields are loaded into memory.</p>
</div>
<div class="section" id="abm-example">
<h2>ABM Example<a class="headerlink" href="#abm-example" title="Permalink to this headline">¶</a></h2>
<div class="section" id="models">
<h3>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h3>
<p>The models are:</p>
<blockquote>
<div><ul class="simple">
<li><p>demographics_processor - disaggregate person calculations</p></li>
<li><p>person_trips_processor - disaggregate trip calculations</p></li>
<li><p>auto_ownership_processor - disaggregate person (and household) auto ownership calculations</p></li>
<li><p>physical_activity_processor - disaggregate person and trip physical activity calculations</p></li>
<li><p>aggregate_trips_processor - aggregate (matrix-based) calculations</p></li>
<li><p>link_daily_processor - daily link-based calculations</p></li>
<li><p>link_processor - time period link-based calculations</p></li>
<li><p>finalize_abm_results - writes results by equity group (aka COC or community of concern)</p></li>
<li><p>write_data_dictionary - writes data pipeline data table column types for debugging</p></li>
<li><p>write_tables - writes output files</p></li>
</ul>
</div></blockquote>
<p>The current set of files are below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Model</p></th>
<th class="head"><p>Specification Files</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>demographics_processor</p></td>
<td><ul class="simple">
<li><p>demographics.yaml</p></li>
<li><p>demographics.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>person_trips_processor</p></td>
<td><ul class="simple">
<li><p>person_trips.yaml</p></li>
<li><p>person_trips.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>auto_ownership_processor</p></td>
<td><ul class="simple">
<li><p>auto_ownership.yaml</p></li>
<li><p>auto_ownership.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>physical_activity_processor</p></td>
<td><ul class="simple">
<li><p>physical_activity.yaml</p></li>
<li><p>physical_activity_person.csv</p></li>
<li><p>physical_activity_trip.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>aggregate_trips_processor</p></td>
<td><ul class="simple">
<li><p>aggregate_trips.yaml</p></li>
<li><p>aggregate_trips.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>link_daily_processor</p></td>
<td><ul class="simple">
<li><p>link_daily.yaml</p></li>
<li><p>link_daily.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>link_processor</p></td>
<td><ul class="simple">
<li><p>link.yaml</p></li>
<li><p>link.csv</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>ABM expression file specifics:</p>
<blockquote>
<div><ul class="simple">
<li><p>All target fields specified in the expressions file will be aggregated and written out to the summary results file.  Each summary result entry is named as follows: the two digit processor abbreviation + the target field.  For example: AO_base_auto_ownership_cost.</p></li>
<li><p>aggregate_trips.csv references the fields in aggregate_data_manifest.csv as: <cite>base_trips, build_trips, base_ivt, build_ivt, vot, aoc_units, base_aoc, build_aoc, toll_units, base_toll, build_toll</cite></p></li>
<li><p>auto_ownership.csv, demographics.csv, physical_activity_person.csv refer to the person table as <cite>persons</cite></p></li>
<li><p>link.csv, link_daily.csv refer to the links table as <cite>links</cite></p></li>
<li><p>person_trips.csv refers to the trips table as <cite>trips</cite></p></li>
<li><p>physical_activity_trip.csv refers to the base and build trips as <cite>trips, base, build</cite></p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">data</span></code> folder contains the input data for the base and build scenario.</p>
<blockquote>
<div><ul>
<li><p>Disaggregate data</p>
<ul class="simple">
<li><p>persons.csv - base and build alternative person records</p></li>
<li><p>base_households.csv - base alternative households</p></li>
<li><p>build_households.csv - build alternative households</p></li>
<li><p>basetrips_normal.csv - base alternative trips with base alternative trip level-of-service</p></li>
<li><p>basetrips_buildlos.csv - base alternative trips with build alternative trip level-of-service</p></li>
<li><p>buildtrips_normal.csv - build alternative trips with build alternative trip level-of-service</p></li>
<li><p>buildtrips_baselos.csv - build alternative trips with base alternative trip level-of-service</p></li>
</ul>
</li>
<li><p>Aggregate data</p>
<ul>
<li><p>aggregate_data_manifest.csv - aggregate markets for which to apply the aggregate calculations defined in aggregate_trips.csv - each row in the manifest contains a trip matrix, an in-vehicle time matrix, an auto operating cost matrix, and a toll matrix.  Each matrix will be loaded for the base and build alternative from the base and build data folders.  These matrices + the additional settings in each row for units, value-of-time, etc. are referenced in the expressions.</p></li>
<li><p>base data folder</p>
<blockquote>
<div><ul class="simple">
<li><p>testlos.omx - base alternative level-of-service matrices - IVT, opercost, tollcost</p></li>
<li><p>testtrips.omx - base alternative trips</p></li>
</ul>
</div></blockquote>
</li>
<li><p>build data folder</p>
<blockquote>
<div><ul class="simple">
<li><p>testlos.omx - build alternative level-of-service matrices - IVT, opercost, tollcost</p></li>
<li><p>testtrips.omx - build alternative trips</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</li>
<li><p>Link data</p>
<ul class="simple">
<li><p>link_data_manifest.csv - link time period tables to process in link processor.  The daily like table is not specified since it is handled by a separate daily link processor.</p></li>
<li><p>base data folder</p>
<ul>
<li><p>link_ampk.csv - base alternative AM peak link records</p></li>
<li><p>link_daily.csv - base alternative daily link records</p></li>
</ul>
</li>
<li><p>build data folder</p>
<ul>
<li><p>link_ampk.csv - build alternative AM peak link records</p></li>
<li><p>link_daily.csv - build alternative daily  link records</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="outputs">
<h3>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h3>
<p>The ABM example outputs are:</p>
<blockquote>
<div><ul class="simple">
<li><p>asim.log - log file</p></li>
<li><p>data_dict.txt - pipeline table data and fields</p></li>
<li><p>final_summary_results.csv - all calculated measures.  All target fields specified in the expressions file will be aggregated and written out to the summary results file. Each summary result entry is named as follows: the two digit processor abbreviation + the target field. For example: <cite>AO_base_auto_ownership_cost</cite>.</p></li>
<li><p>final_checkpoints.csv - tables in the pipeline for debugging if desired</p></li>
<li><p>final_coc_results.csv - results by community of concern</p></li>
<li><p>final_coc_silos.csv - results by community of concern</p></li>
<li><p>pipeline.h5.h5 - HDF5 data pipeline which contains all the data tables in pandas format and can be read into pandas with <cite>pd.read_hdf</cite>.</p></li>
<li><p>If <cite>trace_hh_id</cite> is specified in the settings file:</p>
<ul>
<li><p>auto_ownership.csv - results by person</p></li>
<li><p>demographics.csv - results by person</p></li>
<li><p>person_trips.csv - results by person</p></li>
<li><p>physical_activity_persons.csv - results by person</p></li>
<li><p>physical_activity_trips.csv - results by trip</p></li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="four-step-example">
<h2>Four-Step Example<a class="headerlink" href="#four-step-example" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Models<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The models are:</p>
<blockquote>
<div><ul class="simple">
<li><p>aggregate_demographics_processor - zone-based calculations to identify equity groups</p></li>
<li><p>aggregate_zone_processor - zone-based calculations such as auto ownership and destination choice logsums benefits</p></li>
<li><p>aggregate_zone_benefits - sum benefits by equity group</p></li>
<li><p>aggregate_od_processor - OD pair-based calaculations such as travel time savings</p></li>
<li><p>link_daily_processor - daily link-based calculations such as safety and emissions</p></li>
<li><p>write_data_dictionary - writes data pipeline data table column types for debugging</p></li>
<li><p>write_tables - writes output files</p></li>
</ul>
</div></blockquote>
<p>The current set of files are below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Model</p></th>
<th class="head"><p>Specification Files</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>aggregate_demographics_processor</p></td>
<td><ul class="simple">
<li><p>aggregate_demographics.yaml</p></li>
<li><p>aggregate_demographics.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>aggregate_zone_processor</p></td>
<td><ul class="simple">
<li><p>aggregate_zone.yaml</p></li>
<li><p>aggregate_zone.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>aggregate_od_processor</p></td>
<td><ul class="simple">
<li><p>aggregate_od.yaml</p></li>
<li><p>aggregate_od.csv</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>link_daily_processor</p></td>
<td><ul class="simple">
<li><p>link_daily.yaml</p></li>
<li><p>link_daily.csv</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>4Step expression file specifics:</p>
<blockquote>
<div><ul class="simple">
<li><p>The <cite>silo</cite> column in the expressions files is used for specifying the relevant communities-of-concern (COC) for the result. An <cite>*</cite> is used to specify that the result applies to everyone.  If the result applies to just one COC, for example, low_income hhs, then the silo entry should correspond to a valid <cite>coc_silos</cite> entry in the setting file, such as <cite>coc_lowinc.</cite></p></li>
<li><p>aggregate_demographics.csv refers to the zone table as <cite>cvals</cite></p></li>
<li><p>aggregate_zone.csv refers to the zone table as <cite>zones</cite> and prepends <cite>base_</cite> or <cite>build_</cite></p></li>
<li><p>aggregate_od.csv refers to the matrices specified in <cite>aggregate_od_matrices</cite> by name and appends <cite>_base</cite> or <cite>_build</cite></p></li>
<li><p>link.csv refers to the links table specified in the <cite>link_daily_file_names</cite> by <cite>links</cite> plus the name appended</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id3">
<h3>Data<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">data</span></code> folder contains the input data for the base and build scenario.</p>
<blockquote>
<div><ul class="simple">
<li><p>Link</p>
<ul>
<li><p>linksMD1.csv - link MD1 period assignment results</p></li>
<li><p>linksPM2.csv - link PM2 assignment results</p></li>
</ul>
</li>
<li><p>OD</p>
<ul>
<li><p>assign_mfs.omx - assignment matrices</p></li>
<li><p>skims_mfs.omx - skims matrices</p></li>
<li><p>mode_choice_pa.omx - mode choice production-attraction matrices</p></li>
<li><p>parking_cost.omx - parking costs at the destination</p></li>
</ul>
</li>
<li><p>Zone</p>
<ul>
<li><p>mf.cval.csv - see above</p></li>
<li><p>cocs.csv - externally defined COC share of households by zone</p></li>
<li><p>Productions files such as ma.hboprh.csv (hbo high inc)</p></li>
<li><p>Destination choice logsums files such as ma.hbohdcls.csv (hbo high inc)</p></li>
</ul>
</li>
<li><p>zone_districts.csv - zone district scheme for district-to-district O-D processor aggregate report and for zone labels if zones non-sequential</p></li>
<li><p>moves_2010_summer_running_rates.csv - EPA MOVES emissions rate table lookup file</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id4">
<h3>Outputs<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>The 4step example outputs are:</p>
<blockquote>
<div><ul class="simple">
<li><p>bca.log - log file</p></li>
<li><p>data_dict.txt - pipeline table data and fields</p></li>
<li><p>final_aggregate_results.csv - results by measure and COC, including for everyone</p></li>
<li><p>pipeline.h5.h5 - HDF5 data pipeline which contains all the data tables in pandas format and can be read into pandas with <cite>pd.read_hdf</cite>.</p></li>
<li><p>Intermediate outputs for debugging</p>
<ul>
<li><p>final_zone_demographics.csv - demographics processor calculated fields for each zone</p></li>
<li><p>final_aggregate_zone_summary.csv - zone processor calculated fields for each zone</p></li>
<li><p>final_aggregate_od_zone_summary.csv - OD processor calculated fields summed to each origin zone</p></li>
<li><p>final_aggregate_od_district_summary.csv - District-to-district OD processor calculated fields summed</p></li>
<li><p>link_daily_results_base|build.csv - link processor calculated fields</p></li>
</ul>
</li>
<li><p>If <cite>trace_od</cite> is specified in the settings file:</p>
<ul>
<li><p>aggregate_demographics.csv - demographics processor calculated fields for the trace origin zone</p></li>
<li><p>aggregate_zone.csv - zone processor calculated fields for the trace origin zone</p></li>
<li><p>aggregate_od.csv - OD processor calculated fields for the trace OD pair</p></li>
<li><p>link_daily_results_build.csv - build scenario link processor calculated fields for links in the trace origin or destination zone</p></li>
<li><p>link_daily_results_base.csv - base scenario link processor calculated fields for links in the trace origin or destination zone</p></li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="software.html" class="btn btn-neutral float-right" title="Software Implementation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gettingstarted.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright contributing authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>