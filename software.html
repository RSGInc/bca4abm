

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Software Implementation &mdash; bca4abm 0.4
 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Resources" href="resources.html" />
    <link rel="prev" title="Examples" href="examples.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> bca4abm
          

          
          </a>

          
            
            
              <div class="version">
                0.4

              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Software Implementation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#activitysim-framework">ActivitySim Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common">Common</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-bca4abm.bca4abm">bca4abm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-bca4abm.processors.aggregate_trips">aggregate_trips</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-bca4abm.processors.link">link</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#abm-processors">ABM Processors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-bca4abm.processors.abm.abm_results">abm_results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-bca4abm.processors.abm.auto_ownership">auto_ownership</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-bca4abm.processors.abm.demographics">demographics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-bca4abm.processors.abm.person_trips">person_trips</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-bca4abm.processors.abm.physical_activity">physical_activity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#four-step-processors">Four Step Processors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-bca4abm.processors.four_step.aggregate_demographics">aggregate_demographics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-bca4abm.processors.four_step.aggregate_zone">aggregate_zone</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-bca4abm.processors.four_step.aggregate_od">aggregate_od</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#contribution-guidelines">Contribution Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#release-notes">Release Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">bca4abm</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Software Implementation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/software.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="software-implementation">
<h1>Software Implementation<a class="headerlink" href="#software-implementation" title="Permalink to this headline">¶</a></h1>
<p>This page describes the bca4abm software implementation and how to contribute.</p>
<p>The implementation starts with
the ActivitySim framework, which serves as the foundation for the software.  The framework, as briefly described
below, includes features for data pipeline management, expression handling, testing, etc.  Built upon the
framework are additional core components for benefits calculation.</p>
<div class="section" id="activitysim-framework">
<h2>ActivitySim Framework<a class="headerlink" href="#activitysim-framework" title="Permalink to this headline">¶</a></h2>
<p>bca4abm is implemented in the <a class="reference external" href="https://github.com/activitysim/activitysim">ActivitySim</a>
framework.  As summarized <a class="reference external" href="https://activitysim.github.io/activitysim/#software-design">here</a>,
being implemented in the ActivitySim framework means:</p>
<ul class="simple">
<li>Overall Design<ul>
<li>Implemented in Python, and makes heavy use of the vectorized backend C/C++ libraries in <a class="reference external" href="http://pandas.pydata.org">pandas</a> and <a class="reference external" href="http://www.numpy.org">numpy</a>.</li>
<li>Vectorization instead of for loops when possible</li>
<li>Runs sub-models that solve Python expression files that operate on data tables</li>
</ul>
</li>
<li>Data Handling<ul>
<li>Inputs are in CSV format, with the exception of settings</li>
<li>CSVs are read-in as pandas tables and stored in an intermediate HDF5 binary file that is used for data I/O throughout the model run</li>
<li>Key outputs are written to CSV files</li>
</ul>
</li>
<li>Key Data Structures<ul>
<li><a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html">pandas.DataFrame</a> - A data table with rows and columns, similar to an R data frame, Excel worksheet, or database table</li>
<li><a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.html">pandas.Series</a> - a vector of data, a column in a DataFrame table or a 1D array</li>
<li><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html">numpy.array</a> - an N-dimensional array of items of the same type, such as a matrix</li>
</ul>
</li>
<li>Model Orchestrator<ul>
<li><a class="reference external" href="https://github.com/UDST/orca">ORCA</a> is used for running the overall model system and for defining dynamic data tables, columns, and injectables (functions). ActivitySim wraps ORCA functionality to make a Data Pipeline tool, which allows for re-starting at any model step.</li>
</ul>
</li>
<li>Expressions<ul>
<li>Model expressions are in CSV files and contain Python expressions, mainly pandas/numpy expression that operate on the input data tables. This helps to avoid modifying Python code when making changes to the model calculations.</li>
</ul>
</li>
<li><a class="reference external" href="https://activitysim.github.io/activitysim/development.html">Code Documentation</a><ul>
<li>Python code according to <a class="reference external" href="https://pypi.python.org/pypi/pycodestyle">pycodestyle</a> style guide</li>
<li>Written in <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> markup, built with <a class="reference external" href="http://www.sphinx-doc.org/en/stable">Sphinx</a> and docstrings written in <a class="reference external" href="https://github.com/numpy/numpy/blob/master/doc/HOWTO_DOCUMENT.rst.txt">numpydoc</a></li>
</ul>
</li>
<li><a class="reference external" href="https://activitysim.github.io/activitysim/development.html">Testing</a><ul>
<li>A protected master branch that can only be written to after tests have passed</li>
<li><a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a> for tests</li>
<li><a class="reference external" href="https://travis-ci.org">TravisCI</a> for building and testing with each commit</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="common">
<h2>Common<a class="headerlink" href="#common" title="Permalink to this headline">¶</a></h2>
<p>Software components common to both ABM and four-step model usage.</p>
<div class="section" id="module-bca4abm.bca4abm">
<span id="bca4abm"></span><h3>bca4abm<a class="headerlink" href="#module-bca4abm.bca4abm" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="bca4abm.bca4abm.calc_rows_per_chunk">
<code class="descclassname">bca4abm.bca4abm.</code><code class="descname">calc_rows_per_chunk</code><span class="sig-paren">(</span><em>chunk_size</em>, <em>df</em>, <em>spec</em>, <em>extra_columns=0</em>, <em>trace_label=None</em><span class="sig-paren">)</span><a class="headerlink" href="#bca4abm.bca4abm.calc_rows_per_chunk" title="Permalink to this definition">¶</a></dt>
<dd><p>simple rows_per_chunk calculator for chunking calls to assign_variables</p>
</dd></dl>

<dl class="function">
<dt id="bca4abm.bca4abm.eval_and_sum">
<code class="descclassname">bca4abm.bca4abm.</code><code class="descname">eval_and_sum</code><span class="sig-paren">(</span><em>assignment_expressions</em>, <em>df</em>, <em>locals_dict</em>, <em>group_by_column_names=None</em>, <em>df_alias=None</em>, <em>chunk_size=0</em>, <em>trace_rows=None</em><span class="sig-paren">)</span><a class="headerlink" href="#bca4abm.bca4abm.eval_and_sum" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate assignment_expressions against df, and sum the results
(sum by group if list of group_by_column_names is specified.
e.g. group by coc column names and return sums grouped by community of concern.)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>assignment_expressions</strong></dt>
<dd></dd>
<dt><strong>df</strong></dt>
<dd></dd>
<dt><strong>locals_dict</strong></dt>
<dd></dd>
<dt><strong>group_by_column_names</strong> <span class="classifier-delimiter">:</span> <span class="classifier">array of str</span></dt>
<dd><p class="first last">list of names of the columns to group by (e.g. coc_column_names of trip_coc_end)</p>
</dd>
<dt><strong>df_alias</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str</span></dt>
<dd><p class="first last">assign_variables df_alias (name of df in assignment_expressions)</p>
</dd>
<dt><strong>chunk_size</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd></dd>
<dt><strong>trace_rows</strong> <span class="classifier-delimiter">:</span> <span class="classifier">array of bool</span></dt>
<dd><p class="first last">array indicating which rows in df are to be traced</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="bca4abm.bca4abm.read_assignment_spec">
<code class="descclassname">bca4abm.bca4abm.</code><code class="descname">read_assignment_spec</code><span class="sig-paren">(</span><em>fname</em><span class="sig-paren">)</span><a class="headerlink" href="#bca4abm.bca4abm.read_assignment_spec" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a CSV model specification into a Pandas DataFrame or Series.</p>
<p>The CSV is expected to have columns for component descriptions
targets, and expressions,</p>
<p>The CSV is required to have a header with column names. For example:</p>
<blockquote>
<div>Description,Target,Expression,Silos</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first docutils">
<dt><strong>fname</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str</span></dt>
<dd><p class="first last">Name of a CSV spec file.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>spec</strong> <span class="classifier-delimiter">:</span> <span class="classifier">pandas.DataFrame</span></dt>
<dd><p class="first last">The description column is dropped from the returned data and the
expression values are set as the table index.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="bca4abm.bca4abm.scalar_assign_variables">
<code class="descclassname">bca4abm.bca4abm.</code><code class="descname">scalar_assign_variables</code><span class="sig-paren">(</span><em>assignment_expressions</em>, <em>locals_dict</em><span class="sig-paren">)</span><a class="headerlink" href="#bca4abm.bca4abm.scalar_assign_variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate a set of variable expressions from a spec in the context
of a given data table.</p>
<p>Python expressions are evaluated in the context of this function using
Python’s eval function.
Users should take care that these expressions must result in
a scalar</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first docutils">
<dt><strong>assignment_expressions</strong> <span class="classifier-delimiter">:</span> <span class="classifier">pandas sequence of str</span></dt>
<dd></dd>
<dt><strong>locals_dict</strong> <span class="classifier-delimiter">:</span> <span class="classifier">Dict</span></dt>
<dd><p class="first last">This is a dictionary of local variables that will be the environment
for an evaluation of an expression that begins with &#64;</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>variables</strong> <span class="classifier-delimiter">:</span> <span class="classifier">pandas.DataFrame</span></dt>
<dd><p class="first last">Will have the index of <cite>df</cite> and columns of <cite>exprs</cite>.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-bca4abm.processors.aggregate_trips">
<span id="aggregate-trips"></span><h3>aggregate_trips<a class="headerlink" href="#module-bca4abm.processors.aggregate_trips" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="bca4abm.processors.aggregate_trips.aggregate_trips_processor">
<code class="descclassname">bca4abm.processors.aggregate_trips.</code><code class="descname">aggregate_trips_processor</code><span class="sig-paren">(</span><em>aggregate_trips_spec</em>, <em>settings</em>, <em>data_dir</em><span class="sig-paren">)</span><a class="headerlink" href="#bca4abm.processors.aggregate_trips.aggregate_trips_processor" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute aggregate trips benefits</p>
<p>The data manifest contains a list of trip count files (one for base, one for build)
along with their their corresponding in-vehicle-time (ivt), operating cost (aoc),
and toll skims.</p>
<p>Since the skims are all aligned numpy arrays , we can express their benefit calculation as
vector computations in the aggregate_trips_spec</p>
</dd></dl>

<dl class="data">
<dt id="bca4abm.processors.aggregate_trips.logger">
<code class="descclassname">bca4abm.processors.aggregate_trips.</code><code class="descname">logger</code><em class="property"> = &lt;logging.Logger object&gt;</em><a class="headerlink" href="#bca4abm.processors.aggregate_trips.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregate trips processor</p>
</dd></dl>

</div>
<div class="section" id="module-bca4abm.processors.link">
<span id="link"></span><h3>link<a class="headerlink" href="#module-bca4abm.processors.link" title="Permalink to this headline">¶</a></h3>
<dl class="data">
<dt id="bca4abm.processors.link.logger">
<code class="descclassname">bca4abm.processors.link.</code><code class="descname">logger</code><em class="property"> = &lt;logging.Logger object&gt;</em><a class="headerlink" href="#bca4abm.processors.link.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Link processor</p>
</dd></dl>

</div>
</div>
<div class="section" id="abm-processors">
<h2>ABM Processors<a class="headerlink" href="#abm-processors" title="Permalink to this headline">¶</a></h2>
<p>Software components for ABM model usage.</p>
<div class="section" id="module-bca4abm.processors.abm.abm_results">
<span id="abm-results"></span><h3>abm_results<a class="headerlink" href="#module-bca4abm.processors.abm.abm_results" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="module-bca4abm.processors.abm.auto_ownership">
<span id="auto-ownership"></span><h3>auto_ownership<a class="headerlink" href="#module-bca4abm.processors.abm.auto_ownership" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="bca4abm.processors.abm.auto_ownership.auto_ownership_processor">
<code class="descclassname">bca4abm.processors.abm.auto_ownership.</code><code class="descname">auto_ownership_processor</code><span class="sig-paren">(</span><em>persons_merged</em>, <em>auto_ownership_spec</em>, <em>auto_ownership_settings</em>, <em>coc_column_names</em>, <em>chunk_size</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#bca4abm.processors.abm.auto_ownership.auto_ownership_processor" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute auto ownership benefits</p>
</dd></dl>

<dl class="data">
<dt id="bca4abm.processors.abm.auto_ownership.logger">
<code class="descclassname">bca4abm.processors.abm.auto_ownership.</code><code class="descname">logger</code><em class="property"> = &lt;logging.Logger object&gt;</em><a class="headerlink" href="#bca4abm.processors.abm.auto_ownership.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>auto ownership processor</p>
</dd></dl>

</div>
<div class="section" id="module-bca4abm.processors.abm.demographics">
<span id="demographics"></span><h3>demographics<a class="headerlink" href="#module-bca4abm.processors.abm.demographics" title="Permalink to this headline">¶</a></h3>
<dl class="data">
<dt id="bca4abm.processors.abm.demographics.logger">
<code class="descclassname">bca4abm.processors.abm.demographics.</code><code class="descname">logger</code><em class="property"> = &lt;logging.Logger object&gt;</em><a class="headerlink" href="#bca4abm.processors.abm.demographics.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Demographics processor</p>
</dd></dl>

</div>
<div class="section" id="module-bca4abm.processors.abm.person_trips">
<span id="person-trips"></span><h3>person_trips<a class="headerlink" href="#module-bca4abm.processors.abm.person_trips" title="Permalink to this headline">¶</a></h3>
<dl class="data">
<dt id="bca4abm.processors.abm.person_trips.logger">
<code class="descclassname">bca4abm.processors.abm.person_trips.</code><code class="descname">logger</code><em class="property"> = &lt;logging.Logger object&gt;</em><a class="headerlink" href="#bca4abm.processors.abm.person_trips.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Person trips processor</p>
</dd></dl>

<dl class="function">
<dt id="bca4abm.processors.abm.person_trips.person_trips_processor">
<code class="descclassname">bca4abm.processors.abm.person_trips.</code><code class="descname">person_trips_processor</code><span class="sig-paren">(</span><em>trips_with_demographics</em>, <em>person_trips_spec</em>, <em>person_trips_settings</em>, <em>coc_column_names</em>, <em>settings</em>, <em>chunk_size</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#bca4abm.processors.abm.person_trips.person_trips_processor" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute disaggregate trips benefits</p>
</dd></dl>

</div>
<div class="section" id="module-bca4abm.processors.abm.physical_activity">
<span id="physical-activity"></span><h3>physical_activity<a class="headerlink" href="#module-bca4abm.processors.abm.physical_activity" title="Permalink to this headline">¶</a></h3>
<dl class="data">
<dt id="bca4abm.processors.abm.physical_activity.logger">
<code class="descclassname">bca4abm.processors.abm.physical_activity.</code><code class="descname">logger</code><em class="property"> = &lt;logging.Logger object&gt;</em><a class="headerlink" href="#bca4abm.processors.abm.physical_activity.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>physical activity processor</p>
</dd></dl>

<dl class="function">
<dt id="bca4abm.processors.abm.physical_activity.physical_activity_processor">
<code class="descclassname">bca4abm.processors.abm.physical_activity.</code><code class="descname">physical_activity_processor</code><span class="sig-paren">(</span><em>trips_with_demographics</em>, <em>persons_merged</em>, <em>physical_activity_trip_spec</em>, <em>physical_activity_person_spec</em>, <em>physical_activity_settings</em>, <em>coc_column_names</em>, <em>settings</em>, <em>chunk_size</em>, <em>trace_hh_id</em><span class="sig-paren">)</span><a class="headerlink" href="#bca4abm.processors.abm.physical_activity.physical_activity_processor" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute physical benefits</p>
<p>Physical activity benefits generally accrue if the net physical activity for an individual
exceeds a certain threshold. We calculate individual physical activity based on trips,
so we need to compute trip activity and then sum up to the person level to calculate benefits.
We chunk trips by household id to ensure that all of a persons trips are in the same chunk.</p>
</dd></dl>

</div>
</div>
<div class="section" id="four-step-processors">
<h2>Four Step Processors<a class="headerlink" href="#four-step-processors" title="Permalink to this headline">¶</a></h2>
<p>Software components for four-step model usage.</p>
<div class="section" id="module-bca4abm.processors.four_step.aggregate_demographics">
<span id="aggregate-demographics"></span><h3>aggregate_demographics<a class="headerlink" href="#module-bca4abm.processors.four_step.aggregate_demographics" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="bca4abm.processors.four_step.aggregate_demographics.aggregate_demographics_processor">
<code class="descclassname">bca4abm.processors.four_step.aggregate_demographics.</code><code class="descname">aggregate_demographics_processor</code><span class="sig-paren">(</span><em>zone_hhs</em>, <em>aggregate_demographics_spec</em>, <em>settings</em>, <em>trace_od</em><span class="sig-paren">)</span><a class="headerlink" href="#bca4abm.processors.four_step.aggregate_demographics.aggregate_demographics_processor" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>zone_hhs</strong> <span class="classifier-delimiter">:</span> <span class="classifier">orca table</span></dt>
<dd><p class="first last">input zone demographics</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="data">
<dt id="bca4abm.processors.four_step.aggregate_demographics.logger">
<code class="descclassname">bca4abm.processors.four_step.aggregate_demographics.</code><code class="descname">logger</code><em class="property"> = &lt;logging.Logger object&gt;</em><a class="headerlink" href="#bca4abm.processors.four_step.aggregate_demographics.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregate demographics processor</p>
<p>each row in the data table to solve is an origin zone and this processor
calculates communities of concern (COC) / market segments based on mf.cval.csv</p>
</dd></dl>

</div>
<div class="section" id="module-bca4abm.processors.four_step.aggregate_zone">
<span id="aggregate-zone"></span><h3>aggregate_zone<a class="headerlink" href="#module-bca4abm.processors.four_step.aggregate_zone" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="bca4abm.processors.four_step.aggregate_zone.aggregate_zone_processor">
<code class="descclassname">bca4abm.processors.four_step.aggregate_zone.</code><code class="descname">aggregate_zone_processor</code><span class="sig-paren">(</span><em>zones</em>, <em>trace_od</em><span class="sig-paren">)</span><a class="headerlink" href="#bca4abm.processors.four_step.aggregate_zone.aggregate_zone_processor" title="Permalink to this definition">¶</a></dt>
<dd><p>zones: orca table</p>
<p>zone data for base and build scenario dat files combined into a single dataframe
with columns names prefixed with <a href="#id1"><span class="problematic" id="id2">base_</span></a> or <a href="#id3"><span class="problematic" id="id4">build_</span></a> indexed by ZONE</p>
</dd></dl>

<dl class="data">
<dt id="bca4abm.processors.four_step.aggregate_zone.logger">
<code class="descclassname">bca4abm.processors.four_step.aggregate_zone.</code><code class="descname">logger</code><em class="property"> = &lt;logging.Logger object&gt;</em><a class="headerlink" href="#bca4abm.processors.four_step.aggregate_zone.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregate zone processor</p>
<p>each row in the data table to solve is an origin zone and this
processor calculates zonal auto ownership differences as well as the
differences in the destination choice logsums - ma.&lt;purpose|income&gt;dcls.csv
Maybe the ma.&lt;purpose|income&gt;dcls.csv files should be added to the
mf.cval.csv before input to the bca tool?</p>
</dd></dl>

</div>
<div class="section" id="module-bca4abm.processors.four_step.aggregate_od">
<span id="aggregate-od"></span><h3>aggregate_od<a class="headerlink" href="#module-bca4abm.processors.four_step.aggregate_od" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="bca4abm.processors.four_step.aggregate_od.ODSkims">
<em class="property">class </em><code class="descclassname">bca4abm.processors.four_step.aggregate_od.</code><code class="descname">ODSkims</code><span class="sig-paren">(</span><em>omx_file_path</em>, <em>name</em>, <em>zone_index</em>, <em>transpose=False</em>, <em>cache_skims=True</em><span class="sig-paren">)</span><a class="headerlink" href="#bca4abm.processors.four_step.aggregate_od.ODSkims" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper for skim arrays to facilitate use of skims by aggregate_od_processor</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>skims_dict</strong> <span class="classifier-delimiter">:</span> <span class="classifier">empty dict to cache skims read from file</span></dt>
<dd></dd>
<dt><strong>omx: open omx file object</strong></dt>
<dd><p class="first last">this is only used to load skims on demand that were not preloaded</p>
</dd>
<dt><strong>length: int</strong></dt>
<dd><p class="first last">number of zones in skim to return in skim matrix
in case the skims contain additional external zones that should be trimmed out so skim
array is correct shape to match (flattened) O-D tiled columns in the od dataframe</p>
</dd>
<dt><strong>transpose: bool</strong></dt>
<dd><p class="first last">whether to transpose the matrix before flattening. (i.e. act as a D-O instead of O-D skim)</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="bca4abm.processors.four_step.aggregate_od.create_zone_matrices">
<code class="descclassname">bca4abm.processors.four_step.aggregate_od.</code><code class="descname">create_zone_matrices</code><span class="sig-paren">(</span><em>model_settings</em>, <em>zones</em><span class="sig-paren">)</span><a class="headerlink" href="#bca4abm.processors.four_step.aggregate_od.create_zone_matrices" title="Permalink to this definition">¶</a></dt>
<dd><p>ODSkims look-alikes that have identical values for all zone origins/dests</p>
<p>i.e. we either repeat (origin_zone_matrices) or tile (dest_zone_matrices) zone values
to expand zones columns into ODSkims-style flattened arrays</p>
</dd></dl>

<dl class="data">
<dt id="bca4abm.processors.four_step.aggregate_od.logger">
<code class="descclassname">bca4abm.processors.four_step.aggregate_od.</code><code class="descname">logger</code><em class="property"> = &lt;logging.Logger object&gt;</em><a class="headerlink" href="#bca4abm.processors.four_step.aggregate_od.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregate OD processor</p>
<p>each row in the data table to solve is an OD pair and this processor
calculates trip differences.  It requires the access to input zone tables,
the COC coding, trip matrices and skim matrices.  The new
OD_aggregate_manifest.csv file tells this processor what data it can
use and how to reference it.  The following input data tables are required:
assign_mfs.omx, inputs and results of the zone aggregate processor, and skims_mfs.omx.</p>
</dd></dl>

</div>
</div>
<div class="section" id="contribution-guidelines">
<h2>Contribution Guidelines<a class="headerlink" href="#contribution-guidelines" title="Permalink to this headline">¶</a></h2>
<p>bca4abm development follows the same <a class="reference external" href="https://activitysim.github.io/activitysim/development.html">development guidelines</a> as ActivitySim.</p>
</div>
<div class="section" id="release-notes">
<h2>Release Notes<a class="headerlink" href="#release-notes" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>v0.4 - first release</li>
</ul>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="resources.html" class="btn btn-neutral float-right" title="Resources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="examples.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright contributing authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>